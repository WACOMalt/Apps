
<!DOCTYPE html>
<html lang=en>
	<head>
		<meta charset=utf-8>
		<title>Hello Sphere</title>
		<script src="http://sdk.altvr.com/libs/three.js/r73/build/three.js"></script>
		<script src="/res/altspace.min.js"></script>
		<script src="http://sdk.altvr.com/libs/three.js/r73/examples/js/loaders/MTLLoader.js"></script>
	</head>
	<body>
		

		<script>
		if (!window.altspace) document.write('<h3>To view this example, please open this page in <a href="http://altvr.com"> AltspaceVR </a></h3>');

		function getParameterByName(name) {
	        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
	        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
	            results = regex.exec(location.search);
	        return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
	    }

		//Setup
		var scene = new THREE.Scene();
		var renderer = altspace.getThreeJSRenderer({version:'0.2.0'});

		var sphereGeo1 = new THREE.SphereGeometry(400, 20, 20, Math.PI + 0.3, -2*Math.PI);
		var sphereGeo2 = new THREE.SphereGeometry(400, 20, 20, Math.PI + 0.3, -2*Math.PI);
		var texture1 = THREE.ImageUtils.loadTexture( "https://upload.wikimedia.org/wikipedia/commons/a/a1/ESO_-_The_Milky_Way_panorama_(by).jpg" );
		var texture2 = THREE.ImageUtils.loadTexture( "panohaze.png" );
		texture1.needsUpdate = true;
		texture2.needsUpdate = true;
		texture1.minFilter = THREE.LinearFilter;
		texture2.minFilter = THREE.LinearFilter;
		texture1.magFilter = THREE.LinearFilter;
		texture2.magFilter = THREE.LinearFilter;
		texture1.format = THREE.RGBFormat;
		texture2.format = THREE.RGBAFormat;

		
		var sphereMaterial1 = new THREE.MeshPhongMaterial( { 
			color: 0xffffff, 
			map: texture1, 
			opacity: 0.8,
  			transparent : true, 
  			side: THREE.DoubleSide } );
			
		var sphereMaterial2 = new THREE.MeshPhongMaterial( { 
			color: 0xffffff, 
			map: texture2, 
			opacity: 0.8,
  			transparent : true, 
  			side: THREE.DoubleSide } );

		sphereMesh1 = new THREE.Mesh(sphereGeo1, sphereMaterial1);
		sphereMesh1.position.x = 0;
		sphereMesh1.position.y = 0;
		sphereMesh1.position.z = 0;
		
		sphereMesh2 = new THREE.Mesh(sphereGeo2, sphereMaterial2);
		sphereMesh2.position.x = 0;
		sphereMesh2.position.y = 0;
		sphereMesh2.position.z = 0;

		sphereMesh1.scale.z = -1;
		sphereMesh2.scale.z = -1;
		scene.add(sphereMesh1);


		var geometry = new THREE.BoxGeometry(50, 50, 50);
		var materialCreator = new THREE.MTLLoader.MaterialCreator();
		materialCreator.crossOrigin = 'anonymous';

		var expandTexture = materialCreator.loadTexture('res/expand.png');
		var collapseTexture = materialCreator.loadTexture('res/collapse.png');


		var isLarge = getParameterByName('large') == 'true';

		var expandMaterial = new THREE.MeshBasicMaterial({color:'#fff', map: expandTexture});
		var expandCube = new THREE.Mesh(geometry, expandMaterial);
		expandCube.position.x = 300;
		expandCube.position.y = -350;
		expandCube.position.z = 300;
		expandCube.visible = !isLarge;
		scene.add(expandCube);
		
		var collapseMaterial = new THREE.MeshBasicMaterial({color:'#fff', map: collapseTexture});
		var collapseCube = new THREE.Mesh(geometry, collapseMaterial);
		collapseCube.position.x = 300;
		collapseCube.position.y = -350;
		collapseCube.position.z = 300;
		collapseCube.visible = isLarge;
		scene.add(collapseCube);

		var size1 = 900;
		var size2 = 800;

		if (isLarge) {
			sphereMesh1.scale.set(size1, size1, size1);
			sphereMesh2.scale.set(size2, size2, size2);
		}
		expandCube.visible = false;
		collapseCube.visible = false;
		
		var big = true;
		expandCube.addEventListener('cursordown', function() {
			console.log('expand');

			//window.location.href = window.location.origin + window.location.pathname + '?large=true';

			expandCube.visible = false;
			collapseCube.visible = false;

			big = true;

			sphereMesh1.scale.set(size1, size1, size1);
			sphereMesh2.scale.set(size2, size2, size2);
		});

		collapseCube.addEventListener('cursordown', function() {
			console.log('collapse');

			//window.location.href = window.location.origin + window.location.pathname + '?large=false';
			
			expandCube.visible = false;
			collapseCube.visible = false;

			big = false;

			sphereMesh1.scale.set(1, 1, 1);
			sphereMesh2.scale.set(1.1, 1.1, 1.1);
		});

		//Update & Rendering
		function animate() {
			requestAnimationFrame(animate);
			renderer.render(scene);
			sphereMesh1.rotation.x += -0.0000195;
			sphereMesh1.rotation.y += -0.0000165;
			sphereMesh1.rotation.z += -0.0000155;
		}
		animate();

		</script>
	</body>
</html>



