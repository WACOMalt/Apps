
<!DOCTYPE html>
<html lang=en>
	<head>
		<meta charset=utf-8>
		<title>Hello Sphere</title>
		<script src="http://sdk.altvr.com/libs/three.js/r73/build/three.js"></script>
		<script src="/res/altspace.min.js"></script>
		<script src="http://sdk.altvr.com/libs/three.js/r73/examples/js/loaders/MTLLoader.js"></script>
	</head>
	<body>
		<!-- <img style="display:none;" id="frame" src="http://www.qwerty.com/Environmental_Imaging/WI-Capitol-360-180-L%20small.jpg"/> -->
		<!-- <img id="frame" src="/res/R0010631.JPG"/>
		 -->
	<!-- 
		<video style="width:640px;height:360px;" autoplay>
		    <source src="/res/devstories.webm" type="video/webm;codecs=&quot;vp8, vorbis&quot;">
		    <source src="http://www.html5rocks.com/en/tutorials/video/basics/devstories.mp4" type="video/mp4;codecs=&quot;avc1.42E01E, mp4a.40.2&quot;">
		</video> -->
		

		<script>
		if (!window.altspace) document.write('<h3>To view this example, please open this page in <a href="http://altvr.com"> AltspaceVR </a></h3>');

		function getParameterByName(name) {
	        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
	        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
	            results = regex.exec(location.search);
	        return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
	    }

		//Setup
		var scene = new THREE.Scene();
		var renderer = altspace.getThreeJSRenderer({version:'0.2.0'});

		var sphereGeo = new THREE.SphereGeometry(400, 20, 20, Math.PI + 0.3, -2*Math.PI);
		// var image = document.getElementById( 'frame' );
		// var texture = new THREE.VideoTexture( image );
		
		var texture = THREE.ImageUtils.loadTexture( "ntbMRqBUheLwjU0Oa-z-3A_welded.jpg" );
		texture.needsUpdate = true;

		texture.minFilter = THREE.LinearFilter;
		texture.magFilter = THREE.LinearFilter;
		texture.format = THREE.RGBFormat;

		
		var sphereMaterial = new THREE.MeshPhongMaterial( { 
			color: 0xffffff, 
			map: texture, 
			opacity: 0.8,
  			transparent : true, 
  			side: THREE.DoubleSide } );

  		//new THREE.MeshBasicMaterial({map: imageTexture});//, color:'green'});
		//sphereMaterial.side = THREE.BackSide;
		sphereMesh = new THREE.Mesh(sphereGeo, sphereMaterial);
		sphereMesh.position.x = 0;
		sphereMesh.position.y = 0;
		sphereMesh.position.z = 0; // pos is closer

		// sphereMesh.addBehaviors(
		// 	alt.Object3DSync({syncData: true}),
		// 	//alt.Spin({speed: 0.0005}),
		// 	{ awake: function(o) {
		// 			o.addEventListener('cursordown', function() {
		// 				o.userData.syncData.color = Please.make_color()[0];//random cololr
		// 				var sync = object3d.getBehaviorByType('Object3DSync');//TODO: better way of doing this
		// 				if (sync) sync.enqueueSend();
		// 			});
		// 		}, 
		// 	  update: function() {

		// 		} 
		// 	}
		// );


		sphereMesh.scale.z = -1;
		//sphereMesh.scale.multiplyScalar(10);
		scene.add(sphereMesh);


		var geometry = new THREE.BoxGeometry(50, 50, 50);
		var materialCreator = new THREE.MTLLoader.MaterialCreator();
		materialCreator.crossOrigin = 'anonymous';

		var expandTexture = materialCreator.loadTexture('res/expand.png');
		var collapseTexture = materialCreator.loadTexture('res/collapse.png');


		var isLarge = getParameterByName('large') == 'true';

		var expandMaterial = new THREE.MeshBasicMaterial({color:'#fff', map: expandTexture});
		var expandCube = new THREE.Mesh(geometry, expandMaterial);
		expandCube.position.x = 300;
		expandCube.position.y = -350;
		expandCube.position.z = 300;
		expandCube.visible = !isLarge;
		scene.add(expandCube);
		
		var collapseMaterial = new THREE.MeshBasicMaterial({color:'#fff', map: collapseTexture});
		var collapseCube = new THREE.Mesh(geometry, collapseMaterial);
		collapseCube.position.x = 300;
		collapseCube.position.y = -350;
		collapseCube.position.z = 300;
		collapseCube.visible = isLarge;
		scene.add(collapseCube);

		var size = 800;

		if (isLarge) {
			sphereMesh.scale.set(size, size, size);
		}
		expandCube.visible = false;
		collapseCube.visible = false;
		
		var big = true;
		expandCube.addEventListener('cursordown', function() {
			console.log('expand');

			//window.location.href = window.location.origin + window.location.pathname + '?large=true';

			expandCube.visible = false;
			collapseCube.visible = false;

			big = true;

			sphereMesh.scale.set(size, size, size);
		});

		collapseCube.addEventListener('cursordown', function() {
			console.log('collapse');

			//window.location.href = window.location.origin + window.location.pathname + '?large=false';
			
			expandCube.visible = false;
			collapseCube.visible = false;

			big = false;

			sphereMesh.scale.set(1, 1, 1);
		});

		//Update & Rendering
		function animate() {
			requestAnimationFrame(animate);
			renderer.render(scene);
			//	sphereMesh.rotation.x += 0.05;
		}
		animate();

		</script>
	</body>
</html>



